<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClimateView – Global Impact</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f7f7f5; color: #1a1a1a;
  overflow: hidden; height: 100vh; width: 100vw;
}
#header {
  position: fixed; top: 0; left: 0; right: 0; height: 96px;
  background: #ffffff; display: flex; align-items: center;
  justify-content: space-between; padding: 0 48px; z-index: 1000;
}
.cv-logo { height: 34px; width: auto; }
#color-bar {
  position: fixed; top: 96px; left: 0; right: 0; height: 4px;
  display: flex; z-index: 1000;
}
#color-bar span { flex: 1; }
.cb-green { background: #4CAF50; }
.cb-coral { background: #E74C3C; }
.cb-blue { background: #2196F3; }
.cb-teal { background: #26A69A; }
.cb-yellow { background: #FFC107; }
.counter-group { display: flex; align-items: center; gap: 16px; }
.counter {
  font-size: 64px; font-weight: 900; letter-spacing: -3px;
  color: #1a1a1a; line-height: 1; font-variant-numeric: tabular-nums;
}
.counter-meta { display: flex; flex-direction: column; gap: 2px; }
.counter-label { font-size: 18px; font-weight: 400; color: #888; letter-spacing: 0.3px; line-height: 1.2; }
.counter-sub { font-size: 15px; color: #aaa; font-weight: 300; line-height: 1.2; }
#map { position: fixed; top: 100px; left: 0; right: 0; bottom: 0; background: #f0ede8; }
.leaflet-control-attribution { background: rgba(255,255,255,0.75) !important; color: #999 !important; font-size: 9px !important; }
.leaflet-control-attribution a { color: #888 !important; }
.leaflet-control-zoom a { background: #fff !important; color: #555 !important; border-color: #ddd !important; }
.leaflet-control-zoom a:hover { background: #f5f5f5 !important; color: #1a1a1a !important; }
@keyframes pinFlyIn {
  0% { opacity: 0; transform: translateY(-35px) scale(0.2); }
  55% { opacity: 1; transform: translateY(2px) scale(1.04); }
  78% { transform: translateY(-1px) scale(0.98); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}
.pin-marker {
  cursor: pointer; pointer-events: auto;
  filter: drop-shadow(0 1px 2px rgba(0,0,0,0.15));
}
@keyframes pulseRing {
  0% { transform: translate(-50%,-50%) scale(0.7); opacity: 0.7; }
  70% { transform: translate(-50%,-50%) scale(2.2); opacity: 0; }
  100% { transform: translate(-50%,-50%) scale(2.2); opacity: 0; }
}
.pulse-dot {
  position: absolute; top: 35%; left: 50%;
  width: 12px; height: 12px; border-radius: 50%;
  pointer-events: none; z-index: -1;
}
.pulse-dot::before, .pulse-dot::after {
  content: ''; position: absolute; top: 0; left: 0;
  width: 100%; height: 100%; border-radius: 50%;
  border: 2px solid currentColor;
  animation: pulseRing 2.4s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
}
.pulse-dot::after { animation-delay: 1.2s; }
.pin-inner {
  opacity: 0; display: inline-block;
}
.fly-in .pin-inner {
  animation: pinFlyIn 0.55s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}
.city-label span {
  font-family: 'Inter', sans-serif; font-size: 12px; font-weight: 400;
  color: #999; letter-spacing: 0.3px; white-space: nowrap; padding-left: 5px;
}
.leaflet-tooltip {
  background: #ffffff !important; border: 1px solid #e5e5e5 !important;
  color: #1a1a1a !important; font-family: 'Inter', sans-serif !important;
  font-size: 11px !important; font-weight: 500 !important;
  padding: 4px 10px !important; border-radius: 4px !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
  white-space: nowrap !important; letter-spacing: 0.1px;
}
.leaflet-tooltip::before { display: none !important; }
#legend {
  position: fixed; bottom: 36px; left: 48px;
  display: flex; flex-direction: column; gap: 8px;
  padding: 20px 26px; background: rgba(255,255,255,0.92);
  backdrop-filter: blur(12px); border-radius: 10px;
  border: 1px solid #e5e5e5; z-index: 1000;
}
.legend-item {
  display: flex; align-items: center; gap: 10px;
  font-size: 14px; font-weight: 500; color: #666;
  letter-spacing: 0.5px; text-transform: uppercase;
}
.legend-pin { flex-shrink: 0; }
#region-tag {
  position: fixed; top: 120px; right: 48px;
  padding: 10px 28px; border-radius: 24px;
  font-family: 'Inter', sans-serif;
  font-size: 16px; font-weight: 700; letter-spacing: 1.4px;
  text-transform: uppercase; z-index: 1000;
  transition: opacity 0.5s ease, transform 0.5s ease;
  opacity: 0; transform: translateY(-6px);
  box-shadow: 0 2px 10px rgba(0,0,0,0.12);
}
#region-tag.visible { opacity: 1; transform: translateY(0); }
#loading {
  position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%);
  font-family: 'Inter', sans-serif; font-size: 12px; color: #aaa;
  letter-spacing: 0.5px; z-index: 2000;
}
</style>
</head>
<body>
<div id="header">
  <svg viewBox="0 0 1696 257" fill="none" xmlns="http://www.w3.org/2000/svg" class="cv-logo">
<path d="M1543.82 225L1500.78 84.8917H1524.56L1541.88 146.286C1544.46 155.247 1547.05 164.855 1549.64 175.109C1552.22 185.277 1554.8 196.005 1557.39 207.293H1553.77C1556.36 196.263 1558.94 185.665 1561.53 175.497C1564.11 165.243 1566.7 155.506 1569.28 146.286L1586.6 84.8917H1609.61L1626.67 146.286C1629.25 155.334 1631.8 164.984 1634.29 175.238C1636.88 185.406 1639.42 196.091 1641.92 207.293H1638.17C1640.84 196.177 1643.47 185.535 1646.06 175.368C1648.73 165.114 1651.36 155.42 1653.94 146.286L1671.52 84.8917H1695.3L1652.26 225H1629.12L1610.9 161.408C1609.09 155.032 1607.28 148.569 1605.47 142.021C1603.75 135.386 1602.07 128.665 1600.43 121.858C1598.79 115.05 1597.07 108.286 1595.26 101.565H1600.82C1599.1 108.286 1597.37 115.05 1595.65 121.858C1593.93 128.665 1592.2 135.386 1590.48 142.021C1588.76 148.656 1586.95 155.118 1585.05 161.408L1566.57 225H1543.82Z" fill="#1a1a1a"/>
<path d="M1436.21 228.102C1422.59 228.102 1410.92 225.043 1401.18 218.925C1391.45 212.721 1383.95 204.191 1378.69 193.333C1373.52 182.39 1370.94 169.81 1370.94 155.592C1370.94 141.288 1373.57 128.665 1378.82 117.722C1384.16 106.692 1391.57 98.0754 1401.05 91.8713C1410.62 85.5811 1421.65 82.436 1434.14 82.436C1442.84 82.436 1450.94 83.987 1458.44 87.089C1466.02 90.1049 1472.66 94.6287 1478.35 100.66C1484.12 106.692 1488.6 114.189 1491.79 123.15C1494.98 132.112 1496.57 142.495 1496.57 154.3V162.055H1384.38V142.796H1484.29L1474.21 149.647C1474.21 140.254 1472.62 132.025 1469.43 124.96C1466.24 117.894 1461.67 112.379 1455.73 108.415C1449.78 104.452 1442.59 102.47 1434.14 102.47C1425.78 102.47 1418.55 104.495 1412.43 108.545C1406.4 112.508 1401.7 117.937 1398.34 124.83C1395.06 131.638 1393.43 139.35 1393.43 147.966V158.953C1393.43 168.948 1395.15 177.608 1398.6 184.932C1402.04 192.256 1406.96 197.9 1413.33 201.864C1419.79 205.828 1427.46 207.81 1436.34 207.81C1442.46 207.81 1447.89 206.905 1452.62 205.095C1457.45 203.2 1461.5 200.528 1464.77 197.082C1468.05 193.549 1470.5 189.413 1472.14 184.674L1494.24 187.388C1492.35 195.402 1488.69 202.467 1483.26 208.585C1477.91 214.703 1471.19 219.485 1463.09 222.932C1455.08 226.379 1446.12 228.102 1436.21 228.102Z" fill="#1a1a1a"/>
<path d="M1326.92 225V84.8917H1349.54V225H1326.92ZM1338.29 59.6878C1333.99 59.6878 1330.32 58.2229 1327.31 55.2932C1324.29 52.2773 1322.78 48.6583 1322.78 44.4361C1322.78 40.2139 1324.29 36.638 1327.31 33.7083C1330.32 30.7786 1333.94 29.3137 1338.16 29.3137C1342.47 29.3137 1346.14 30.7786 1349.15 33.7083C1352.25 36.638 1353.8 40.257 1353.8 44.5654C1353.8 48.7014 1352.25 52.2773 1349.15 55.2932C1346.14 58.2229 1342.52 59.6878 1338.29 59.6878Z" fill="#1a1a1a"/>
<path d="M1214.79 225L1143.83 32.4158H1169.03L1210.26 147.708C1212.5 154.084 1215.35 162.658 1218.79 173.429C1222.33 184.114 1226.59 197.47 1231.59 213.497H1225.9C1230.73 197.297 1234.91 183.898 1238.44 173.3C1241.97 162.615 1244.82 154.084 1246.97 147.708L1287.17 32.4158H1312.24L1242.06 225H1214.79Z" fill="#1a1a1a"/>
<path d="M1092.18 228.102C1078.57 228.102 1066.89 225.043 1057.16 218.925C1047.42 212.721 1039.92 204.191 1034.67 193.333C1029.5 182.39 1026.91 169.81 1026.91 155.592C1026.91 141.288 1029.54 128.665 1034.8 117.722C1040.14 106.692 1047.55 98.0754 1057.03 91.8713C1066.59 85.5811 1077.62 82.436 1090.12 82.436C1098.82 82.436 1106.92 83.987 1114.42 87.089C1122 90.1049 1128.63 94.6287 1134.32 100.66C1140.09 106.692 1144.57 114.189 1147.76 123.15C1150.95 132.112 1152.54 142.495 1152.54 154.3V162.055H1040.35V142.796H1140.27L1130.18 149.647C1130.18 140.254 1128.59 132.025 1125.4 124.96C1122.21 117.894 1117.65 112.379 1111.7 108.415C1105.76 104.452 1098.56 102.47 1090.12 102.47C1081.76 102.47 1074.52 104.495 1068.4 108.545C1062.37 112.508 1057.67 117.937 1054.31 124.83C1051.04 131.638 1049.4 139.35 1049.4 147.966V158.953C1049.4 168.948 1051.13 177.608 1054.57 184.932C1058.02 192.256 1062.93 197.9 1069.31 201.864C1075.77 205.828 1083.44 207.81 1092.31 207.81C1098.43 207.81 1103.86 206.905 1108.6 205.095C1113.42 203.2 1117.47 200.528 1120.75 197.082C1124.02 193.549 1126.48 189.413 1128.12 184.674L1150.22 187.388C1148.32 195.402 1144.66 202.467 1139.23 208.585C1133.89 214.703 1127.17 219.485 1119.07 222.932C1111.05 226.379 1102.09 228.102 1092.18 228.102Z" fill="#1a1a1a"/>
<path d="M1015.92 84.8917V104.279H941.601V84.8917H1015.92ZM964.737 48.9599H987.356V189.973C987.356 195.746 988.519 199.882 990.846 202.381C993.259 204.88 997.395 206.129 1003.25 206.129C1004.98 206.129 1006.96 206.043 1009.2 205.871C1011.53 205.699 1013.64 205.569 1015.53 205.483L1017.73 224.612C1015.4 225.043 1012.82 225.345 1009.98 225.517C1007.13 225.689 1004.42 225.776 1001.83 225.776C989.769 225.776 980.549 222.889 974.172 217.116C967.882 211.342 964.737 202.984 964.737 192.041V48.9599Z" fill="#1a1a1a"/>
<path d="M864.366 227.585C855.318 227.585 847.132 225.991 839.808 222.803C832.57 219.528 826.797 214.703 822.488 208.327C818.18 201.95 816.026 194.152 816.026 184.932C816.026 176.919 817.62 170.413 820.808 165.415C823.996 160.331 828.219 156.368 833.475 153.524C838.731 150.594 844.633 148.397 851.182 146.932C857.817 145.467 864.495 144.304 871.216 143.443C879.919 142.322 886.856 141.461 892.026 140.857C897.196 140.254 900.944 139.263 903.27 137.885C905.597 136.42 906.76 133.921 906.76 130.388V129.354C906.76 123.926 905.597 119.229 903.27 115.266C901.03 111.216 897.627 108.114 893.06 105.96C888.579 103.719 883.064 102.599 876.515 102.599C869.967 102.599 864.237 103.676 859.325 105.83C854.5 107.898 850.579 110.656 847.563 114.102C844.633 117.549 842.738 121.297 841.876 125.347L819.516 122.116C821.411 113.499 825.073 106.304 830.502 100.531C835.931 94.6717 842.609 90.2341 850.536 87.2183C858.463 84.2024 867.037 82.6945 876.257 82.6945C882.806 82.6945 889.225 83.5561 895.515 85.2795C901.892 87.0028 907.579 89.7602 912.577 93.5516C917.66 97.2568 921.71 102.125 924.726 108.157C927.742 114.189 929.25 121.599 929.25 130.388V225H907.019V205.483H905.985C904.348 208.844 901.849 212.247 898.488 215.694C895.128 219.054 890.647 221.898 885.046 224.225C879.531 226.465 872.638 227.585 864.366 227.585ZM867.856 207.551C876.731 207.551 884.012 205.914 889.699 202.64C895.472 199.365 899.738 195.1 902.495 189.844C905.338 184.587 906.76 178.987 906.76 173.041V154.687C905.899 155.635 904.132 156.497 901.461 157.272C898.79 158.048 895.602 158.78 891.896 159.47C888.277 160.073 884.529 160.676 880.651 161.279C876.86 161.796 873.37 162.27 870.182 162.701C864.754 163.39 859.67 164.597 854.93 166.32C850.191 167.957 846.357 170.37 843.427 173.558C840.497 176.66 839.033 180.839 839.033 186.095C839.033 190.662 840.239 194.54 842.652 197.728C845.064 200.916 848.425 203.372 852.733 205.095C857.042 206.733 862.082 207.551 867.856 207.551Z" fill="#1a1a1a"/>
<path d="M607.404 225V84.8917H629.377L629.506 114.878H627.18C629.506 107.64 632.824 101.651 637.132 96.9121C641.44 92.0867 646.438 88.4677 652.125 86.055C657.812 83.5561 663.758 82.3067 669.962 82.3067C680.56 82.3067 689.349 85.4518 696.329 91.742C703.395 97.9461 707.832 105.658 709.642 114.878H705.764C707.66 108.588 710.805 102.987 715.2 98.0753C719.594 93.1638 724.937 89.3293 731.227 86.572C737.517 83.7285 744.497 82.3067 752.165 82.3067C760.524 82.3067 768.15 84.1162 775.043 87.7353C781.936 91.3543 787.408 96.8259 791.458 104.15C795.594 111.474 797.662 120.737 797.662 131.939V225H775.043V132.327C775.043 121.814 772.07 114.318 766.125 109.837C760.265 105.27 753.415 102.987 745.574 102.987C739.025 102.987 733.381 104.366 728.642 107.123C723.903 109.88 720.24 113.672 717.655 118.497C715.07 123.236 713.778 128.665 713.778 134.783V225H691.288V130C691.288 121.901 688.574 115.395 683.145 110.483C677.717 105.486 670.866 102.987 662.594 102.987C656.994 102.987 651.694 104.322 646.697 106.994C641.699 109.665 637.649 113.629 634.547 118.885C631.531 124.055 630.023 130.517 630.023 138.272V225H607.404Z" fill="#1a1a1a"/>
<path d="M556.407 225V84.8917H579.026V225H556.407ZM567.781 59.6878C563.473 59.6878 559.81 58.2229 556.795 55.2932C553.779 52.2773 552.271 48.6583 552.271 44.4361C552.271 40.2139 553.779 36.638 556.795 33.7083C559.81 30.7786 563.429 29.3137 567.652 29.3137C571.96 29.3137 575.622 30.7786 578.638 33.7083C581.74 36.638 583.291 40.257 583.291 44.5654C583.291 48.7014 581.74 52.2773 578.638 55.2932C575.622 58.2229 572.003 59.6878 567.781 59.6878Z" fill="#1a1a1a"/>
<path d="M528.028 32.4158V225H505.409V32.4158H528.028Z" fill="#1a1a1a"/>
<path d="M403.875 227.844C386.641 227.844 371.433 223.751 358.249 215.565C345.152 207.293 334.898 195.703 327.487 180.796C320.077 165.889 316.372 148.569 316.372 128.837C316.372 108.932 320.077 91.5697 327.487 76.7489C334.898 61.8419 345.152 50.2524 358.249 41.9803C371.433 33.7082 386.641 29.5722 403.875 29.5722C413.784 29.5722 423.09 31.0371 431.793 33.9667C440.582 36.8964 448.467 41.1617 455.446 46.7626C462.426 52.3635 468.199 59.1276 472.766 67.0551C477.419 74.9825 480.65 83.9439 482.46 93.9393H458.29C456.825 87.1321 454.412 81.1004 451.052 75.8441C447.777 70.5879 443.727 66.1934 438.902 62.6605C434.077 59.0415 428.691 56.3272 422.746 54.5177C416.8 52.622 410.51 51.6742 403.875 51.6742C391.208 51.6742 380.05 54.8193 370.399 61.1095C360.834 67.3997 353.338 76.3181 347.909 87.8645C342.567 99.3248 339.896 112.982 339.896 128.837C339.896 144.606 342.61 158.263 348.038 169.81C353.467 181.27 360.963 190.145 370.528 196.436C380.093 202.64 391.208 205.742 403.875 205.742C410.51 205.742 416.8 204.837 422.746 203.027C428.691 201.132 434.033 198.417 438.773 194.884C443.598 191.265 447.691 186.871 451.052 181.701C454.412 176.445 456.868 170.413 458.419 163.606H482.46C480.736 173.515 477.548 182.433 472.895 190.361C468.242 198.202 462.426 204.966 455.446 210.653C448.553 216.254 440.711 220.519 431.922 223.449C423.133 226.379 413.784 227.844 403.875 227.844Z" fill="#1a1a1a"/>
<path d="M145.26 1.08C139.78 0.37 134.18 0 128.5 0C57.53 0 0 57.53 0 128.5C0 199.47 57.53 257 128.5 257C199.47 257 257 199.47 257 128.5C257 63.21 208.31 9.3 145.26 1.08ZM227.19 65.47H192.78C187.95 44.32 181.84 29.55 178.65 22.67C198.57 32.12 215.39 47.03 227.19 65.47ZM183.28 180.08H133.81V76.88H183.88C192 124.25 184.61 172.18 183.28 180.08ZM11.41 128.5C11.41 109.97 15.72 92.45 23.39 76.88H61.19C54.49 118.1 57.07 153.31 62.21 180.08H23.37C15.71 164.52 11.41 147.01 11.41 128.5ZM29.78 191.49H64.66C70.26 215.06 77.33 230.29 79.66 234.95C59.15 225.53 41.84 210.35 29.78 191.49ZM122.4 245.44C114.08 245.01 105.98 243.71 98.21 241.63C87.27 227.17 80.24 209.67 75.86 191.49H122.4V245.44ZM122.4 180.08H73.45C65.3 135.28 71.35 89.41 73.3 76.88H122.4V180.08ZM29.81 65.47C50.61 32.96 87.04 11.41 128.5 11.41C139.69 11.41 150.52 12.98 160.77 15.91C170.97 30.41 177.53 47.66 181.6 65.47H29.81ZM133.81 245.47V191.49H227.22C207.31 222.63 173.08 243.72 133.81 245.47ZM195.37 180.08C202.34 139.04 200.08 103.85 195.13 76.88H233.61C241.28 92.45 245.59 109.97 245.59 128.5C245.59 147.03 241.29 164.52 233.63 180.08H195.37Z" fill="#1a1a1a"/>
</svg>
  <div class="counter-group">
    <div class="counter" id="counter">0</div>
    <div class="counter-meta">
      <div class="counter-label">cities</div>
      <div class="counter-sub" id="country-count"></div>
    </div>
  </div>
</div>
<div id="color-bar">
  <span class="cb-green"></span><span class="cb-coral"></span>
  <span class="cb-blue"></span><span class="cb-teal"></span>
  <span class="cb-yellow"></span>
</div>
<div id="map"></div>
<div id="legend"></div>
<div id="region-tag"></div>
<div id="loading">Loading city data…</div>

<script>
// ---- CONFIG ----
var SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSPDyq7omtmBY0UEq1m3h73GaPR-luCPHYBIMOotenr4HCyUFYi4LFEEOvxmptsiC5w_5YHS2abBHLw/pub?output=csv';
var COORDS = {"Dornbirn": [47.41, 9.74], "Graz": [47.07, 15.44], "Innsbruck": [47.26, 11.39], "Klagenfurt": [46.63, 14.31], "Linz": [48.31, 14.29], "Salzburg": [47.8, 13.04], "St. P\u00f6lten": [48.2, 15.63], "Vienna": [48.21, 16.37], "Villach": [46.61, 13.85], "Wiener Neustadt": [47.81, 16.25], "Ammerland": [53.23, 7.98], "Aurich": [53.47, 7.48], "Braunschweig": [52.27, 10.52], "Celle": [52.62, 10.08], "Cloppenburg": [52.85, 8.05], "Cuxhaven": [53.87, 8.69], "Delmenhorst": [53.05, 8.63], "Diepholz": [52.61, 8.37], "Emden": [53.37, 7.21], "Emsland": [52.84, 7.3], "Friesland": [53.53, 7.92], "Gifhorn": [52.49, 10.55], "Goslar": [51.91, 10.43], "G\u00f6ttingen": [51.53, 9.94], "Grafschaft Bentheim": [52.47, 7.07], "Hameln": [52.1, 9.36], "Hannover": [52.37, 9.74], "Harburg": [53.46, 9.99], "Heidekreis": [52.97, 9.72], "Helmstedt": [52.23, 11.01], "Hildesheim": [52.15, 9.95], "Holzminden": [51.83, 9.45], "Leer": [53.23, 7.45], "L\u00fcchow-Dannenberg": [52.97, 11.15], "L\u00fcneburg": [53.25, 10.41], "Nienburg": [52.64, 9.22], "Northeim": [51.71, 10.0], "Oldenburg": [53.14, 8.21], "Osnabr\u00fcck": [52.28, 8.05], "Osterholz": [53.23, 8.79], "Peine": [52.32, 10.24], "Rotenburg": [53.11, 9.4], "Salzgitter": [52.15, 10.33], "Schaumburg": [52.26, 9.24], "Stade": [53.6, 9.48], "Uelzen": [52.97, 10.56], "Vechta": [52.73, 8.29], "Verden": [52.92, 9.24], "Wesermarsch": [53.38, 8.45], "Wilhelmshaven": [53.53, 8.12], "Wittmund": [53.57, 7.78], "Wolfenb\u00fcttel": [52.16, 10.54], "Wolfsburg": [52.42, 10.79], "Alpen": [51.58, 6.51], "Bergkamen": [51.62, 7.63], "Bochum": [51.48, 7.22], "B\u00f6nen": [51.6, 7.77], "Bottrop": [51.52, 6.93], "Breckerfeld": [51.26, 7.47], "Castrop-Rauxel": [51.55, 7.31], "Datteln": [51.65, 7.35], "Dinslaken": [51.57, 6.73], "Dorsten": [51.66, 6.96], "Dortmund": [51.51, 7.47], "Duisburg": [51.43, 6.76], "Ennepetal": [51.3, 7.36], "Essen": [51.46, 7.01], "Fr\u00f6ndenberg": [51.47, 7.77], "Gelsenkirchen": [51.52, 7.09], "Gevelsberg": [51.32, 7.34], "Gladbeck": [51.57, 6.99], "Hagen": [51.36, 7.47], "Haltern am See": [51.74, 7.19], "Hamm": [51.68, 7.82], "Hamminkeln": [51.73, 6.59], "Hattingen": [51.4, 7.19], "Herdecke": [51.4, 7.43], "Herne": [51.54, 7.22], "Herten": [51.6, 7.14], "Holzwickede": [51.5, 7.63], "H\u00fcnxe": [51.64, 6.77], "Kamen": [51.59, 7.67], "Kamp-Lintfort": [51.5, 6.54], "L\u00fcnen": [51.62, 7.53], "Marl": [51.66, 7.09], "Moers": [51.45, 6.63], "M\u00fclheim an der Ruhr": [51.43, 6.88], "Neukirchen-Vluyn": [51.44, 6.55], "Oberhausen": [51.47, 6.86], "Oer-Erkenschwick": [51.64, 7.27], "Recklinghausen": [51.61, 7.2], "Rheinberg": [51.55, 6.59], "Schermbeck": [51.69, 6.87], "Schwelm": [51.29, 7.3], "Schwerte": [51.45, 7.57], "Selm": [51.7, 7.47], "Siegen": [50.87, 8.02], "Solingen": [51.17, 7.08], "Sonsbeck": [51.61, 6.37], "Sprockh\u00f6vel": [51.35, 7.25], "Unna": [51.54, 7.69], "Voerde": [51.59, 6.69], "Waltrop": [51.62, 7.4], "Wesel": [51.66, 6.62], "Werne": [51.66, 7.63], "Wetter": [51.39, 7.39], "Witten": [51.44, 7.34], "Xanten": [51.66, 6.45], "Bad W\u00f6rishofen": [48.01, 10.6], "Bensheim": [49.68, 8.62], "Berlin": [52.52, 13.41], "Elmshorn": [53.75, 9.66], "Ennepe-Ruhr": [51.33, 7.33], "Frankfurt": [50.11, 8.68], "Friedrichshafen": [47.65, 9.48], "F\u00fcrth": [49.48, 10.99], "Heidelberg": [49.4, 8.69], "Hennef": [50.78, 7.28], "Ha\u00dfberge": [50.1, 10.6], "Jena": [50.93, 11.59], "Karlsruhe": [49.01, 8.4], "Kaufbeuren": [47.88, 10.62], "Kempten": [47.73, 10.32], "Kiel": [54.32, 10.14], "Ludwigsburg": [48.9, 9.19], "Maintal": [50.15, 8.84], "Mannheim": [49.49, 8.47], "M\u00fcnchen": [48.14, 11.58], "Pforzheim": [48.89, 8.7], "Radolfzell": [47.74, 8.97], "Ravensburg": [47.78, 9.61], "Schw\u00e4bisch Hall": [49.11, 9.74], "Stuttgart": [48.78, 9.18], "Trier": [49.75, 6.64], "Ulm": [48.4, 10.0], "Waldshut-Tiengen": [47.62, 8.21], "Baden-W\u00fcrttemberg": [48.66, 9.35], "Hamburg": [53.55, 9.99], "K\u00f6ln": [50.94, 6.96], "Cologne": [50.94, 6.96], "D\u00fcsseldorf": [51.23, 6.78], "Leipzig": [51.34, 12.37], "Dresden": [51.05, 13.74], "N\u00fcrnberg": [49.45, 11.08], "Nuremberg": [49.45, 11.08], "Bremen": [53.08, 8.8], "Bonn": [50.74, 7.1], "Wuppertal": [51.26, 7.17], "Bielefeld": [52.02, 8.53], "M\u00fcnster": [51.96, 7.63], "Aachen": [50.78, 6.08], "Augsburg": [48.37, 10.9], "Freiburg": [47.99, 7.85], "Rostock": [54.09, 12.1], "Erfurt": [50.98, 11.03], "Magdeburg": [52.13, 11.63], "Wiesbaden": [50.08, 8.24], "Mainz": [50.0, 8.27], "Potsdam": [52.4, 13.07], "L\u00fcbeck": [53.87, 10.69], "Saarbr\u00fccken": [49.23, 7.0], "Regensburg": [49.02, 12.1], "W\u00fcrzburg": [49.79, 9.94], "Ingolstadt": [48.76, 11.42], "Darmstadt": [49.87, 8.65], "Kassel": [51.31, 9.5], "Chemnitz": [50.83, 12.92], "Schwerin": [53.63, 11.42], "Cottbus": [51.76, 14.33], "T\u00fcbingen": [48.52, 9.06], "Konstanz": [47.66, 9.18], "Offenbach": [50.1, 8.76], "Passau": [48.57, 13.46], "Bamberg": [49.89, 10.89], "Bayreuth": [49.95, 11.58], "Erlangen": [49.6, 11.01], "G\u00f6rlitz": [51.15, 14.99], "Flensburg": [54.79, 9.44], "Fulda": [50.55, 9.67], "Gie\u00dfen": [50.58, 8.68], "Marburg": [50.81, 8.77], "Paderborn": [51.72, 8.75], "Remscheid": [51.18, 7.19], "Reutlingen": [48.49, 9.21], "G\u00fctersloh": [51.91, 8.38], "Detmold": [51.94, 8.88], "M\u00f6nchengladbach": [51.19, 6.44], "Krefeld": [51.34, 6.56], "Leverkusen": [51.05, 7.0], "Neuss": [51.2, 6.69], "Troisdorf": [50.82, 7.16], "Bergisch Gladbach": [50.99, 7.13], "Iserlohn": [51.38, 7.69], "L\u00fcdenscheid": [51.22, 7.63], "Minden": [52.29, 8.91], "Herford": [52.12, 8.67], "Hilden": [51.17, 6.94], "Ratingen": [51.3, 6.85], "Meerbusch": [51.26, 6.67], "Langenfeld": [51.11, 6.95], "Velbert": [51.34, 7.05], "Viersen": [51.25, 6.39], "Dormagen": [51.1, 6.84], "Grevenbroich": [51.09, 6.59], "Bern": [46.95, 7.45], "Basel": [47.56, 7.59], "Graub\u00fcnden": [46.85, 9.53], "Z\u00fcrich": [47.38, 8.54], "Geneva": [46.2, 6.14], "Lausanne": [46.52, 6.63], "Newcastle": [54.98, -1.61], "Coventry": [52.41, -1.51], "Cambridge": [52.21, 0.12], "Southwark": [51.5, -0.09], "Havering": [51.58, 0.18], "Islington": [51.54, -0.1], "Bristol": [51.45, -2.59], "Newham": [51.53, 0.03], "Nottingham": [52.95, -1.15], "Liverpool": [53.41, -2.98], "Manchester": [53.48, -2.24], "London": [51.51, -0.13], "Birmingham": [52.49, -1.89], "Leeds": [53.8, -1.55], "Sheffield": [53.38, -1.47], "Oxford": [51.75, -1.25], "Dundee": [56.46, -2.97], "Aberdeen": [57.15, -2.09], "Glasgow": [55.86, -4.25], "Dumfries": [55.07, -3.61], "Aberdeenshire": [57.17, -2.5], "Angus": [56.73, -2.92], "Argyll and Bute": [56.2, -5.27], "Clackmannanshire": [56.15, -3.78], "Outer Hebrides": [57.76, -7.01], "East Ayrshire": [55.52, -4.37], "East Dunbartonshire": [55.94, -4.2], "East Lothian": [55.95, -2.77], "East Renfrewshire": [55.78, -4.37], "Edinburgh": [55.95, -3.19], "Falkirk": [56.0, -3.79], "Fife": [56.25, -3.19], "Highland": [57.12, -4.71], "Inverclyde": [55.9, -4.7], "Midlothian": [55.84, -3.11], "Moray": [57.53, -3.28], "North Ayrshire": [55.68, -4.73], "North Lanarkshire": [55.87, -3.97], "Orkney Islands": [59.0, -3.0], "Perth and Kinross": [56.4, -3.44], "Renfrewshire": [55.85, -4.51], "Scottish Borders": [55.55, -2.79], "Shetland Islands": [60.39, -1.17], "South Ayrshire": [55.35, -4.63], "South Lanarkshire": [55.63, -3.79], "Stirling": [56.12, -3.94], "West Dunbartonshire": [55.94, -4.53], "West Lothian": [55.91, -3.56], "Sose": [55.86, -4.25], "Stockholm": [59.33, 18.07], "Borl\u00e4nge": [60.48, 15.44], "Helsingborg": [56.05, 12.69], "Malm\u00f6": [55.6, 13.0], "Bor\u00e5s": [57.72, 12.94], "Sk\u00f6vde": [58.39, 13.84], "Trollh\u00e4ttan": [58.28, 12.29], "Ume\u00e5": [63.83, 20.26], "Uppsala": [59.86, 17.64], "V\u00e4xj\u00f6": [56.88, 14.81], "Lund": [55.7, 13.19], "V\u00e4ster\u00e5s": [59.61, 16.55], "Enk\u00f6ping": [59.64, 17.08], "Eskilstuna": [59.37, 16.51], "G\u00e4vle": [60.67, 17.14], "Gotland": [57.64, 18.3], "Skellefte\u00e5": [64.75, 20.95], "Str\u00e4ngn\u00e4s": [59.38, 17.03], "Tyres\u00f6": [59.24, 18.23], "V\u00e4sterbotten": [64.0, 19.5], "Kronoberg": [56.9, 14.5], "Norrbotten": [66.0, 20.0], "Gothenburg": [57.71, 11.97], "Link\u00f6ping": [58.41, 15.63], "Oslo": [59.91, 10.75], "Copenhagen": [55.68, 12.57], "Helsinki": [60.17, 24.94], "Internetstiftelsen": [59.33, 18.07], "Cambridge, MA": [42.37, -71.11], "Estes Park, CO": [40.38, -105.52], "Phoenix, AZ": [33.45, -112.07], "Sunnyvale, CA": [37.37, -122.04], "Madison, WI": [43.07, -89.4], "Cincinnati, OH": [39.1, -84.51], "Grand Rapids, MI": [42.96, -85.67], "Indianapolis, IN": [39.77, -86.16], "South Bend, IN": [41.68, -86.25], "Louisville, KY": [38.25, -85.76], "Lexington, KY": [38.04, -84.5], "Kansas City, MO": [39.1, -94.58], "Milwaukee, WI": [43.04, -87.91], "Norwalk, CT": [41.12, -73.42], "Roanoke, VA": [37.27, -79.94], "Salem, MA": [42.52, -70.9], "Elk Grove, CA": [38.41, -121.37], "New York City": [40.71, -74.01], "New York": [40.71, -74.01], "Los Angeles": [34.05, -118.24], "Chicago": [41.88, -87.63], "Houston": [29.76, -95.37], "San Francisco": [37.77, -122.42], "Seattle": [47.61, -122.33], "Denver": [39.74, -104.99], "Boston": [42.36, -71.06], "Atlanta": [33.75, -84.39], "Portland": [45.52, -122.68], "Austin": [30.27, -97.74], "San Diego": [32.72, -117.16], "Washington DC": [38.91, -77.04], "Miami": [25.76, -80.19], "Minneapolis": [44.98, -93.27], "Detroit": [42.33, -83.05], "Pittsburgh": [40.44, -80.0], "Charlotte": [35.23, -80.84], "Nashville": [36.16, -86.78], "Columbus": [39.96, -82.99], "San Antonio": [29.42, -98.49], "St. Louis": [38.63, -90.2], "Tampa": [27.95, -82.46], "Baltimore": [39.29, -76.61], "Orlando": [28.54, -81.38], "Cincinnati": [39.1, -84.51], "Milwaukee": [43.04, -87.91], "Norwalk": [41.12, -73.42], "Elk Grove": [38.41, -121.37], "Abilene": [32.45, -99.73], "Alexandria VA": [38.8, -77.05], "Allen": [33.1, -96.67], "Alpharetta": [34.08, -84.29], "Amarillo": [35.22, -101.83], "Appleton": [44.26, -88.41], "Arlington Heights": [42.09, -87.98], "Asheville": [35.6, -82.55], "Ashland OR": [42.19, -122.71], "Athens GA": [33.96, -83.38], "Augusta": [33.47, -81.97], "Aurora IL": [41.76, -88.32], "Avondale": [33.44, -112.35], "Bakersfield": [35.37, -119.02], "Baton Rouge": [30.45, -91.19], "Beaumont": [30.09, -94.1], "Bellevue": [47.61, -122.2], "Bellingham": [48.76, -122.49], "Bend": [44.06, -121.31], "Benicia": [38.05, -122.16], "Billings": [45.78, -108.5], "Binghamton": [42.1, -75.91], "Birmingham AL": [33.52, -86.8], "Bloomington IL": [40.48, -88.99], "Bloomington IN": [39.17, -86.53], "Bloomington MN": [44.84, -93.3], "Boca Raton": [26.36, -80.08], "Bothell": [47.76, -122.21], "Boynton Beach": [26.53, -80.07], "Bozeman": [45.68, -111.04], "Bridgeport": [41.18, -73.19], "Brockton": [42.08, -71.02], "Brookline": [42.33, -71.12], "Brownsville": [25.93, -97.48], "Burlingame": [37.58, -122.37], "Burlington VT": [44.48, -73.21], "Campbell": [37.29, -121.95], "Canton": [40.8, -81.38], "Cape Coral": [26.56, -81.95], "Carlsbad": [33.16, -117.35], "Carmel": [39.98, -86.12], "Carrollton": [32.95, -96.89], "Carson": [33.83, -118.28], "Cary": [35.79, -78.78], "Casper": [42.87, -106.31], "Cedar Hill": [32.59, -96.96], "Cedar Park": [30.51, -97.82], "Cedar Rapids": [41.98, -91.67], "Champaign": [40.12, -88.24], "Chandler": [33.31, -111.84], "Chapel Hill": [35.91, -79.05], "Charlottesville": [38.03, -78.48], "Chesapeake": [36.77, -76.29], "Cheyenne": [41.14, -104.82], "Chico": [39.73, -121.84], "Chula Vista": [32.64, -117.08], "Clearwater": [27.97, -82.76], "Clovis": [36.83, -119.7], "College Station": [30.63, -96.33], "Columbia MO": [38.95, -92.33], "Concord": [37.98, -122.03], "Concord NC": [35.41, -80.58], "Concord NH": [43.21, -71.54], "Coral Springs": [26.27, -80.27], "Corona": [33.88, -117.57], "Corpus Christi": [27.8, -97.4], "Corvallis": [44.56, -123.26], "Costa Mesa": [33.64, -117.92], "Cranston": [41.78, -71.44], "Cupertino": [37.32, -122.03], "Dallas": [32.78, -96.8], "Daly City": [37.69, -122.47], "Davenport": [41.52, -90.58], "Davie": [26.08, -80.28], "Davis": [38.54, -121.74], "Daytona Beach": [29.21, -81.02], "Decatur": [39.84, -88.95], "Decatur GA": [33.77, -84.3], "Deerfield Beach": [26.32, -80.1], "Delray Beach": [26.46, -80.07], "Deltona": [28.9, -81.26], "Denton": [33.21, -97.13], "Downey": [33.94, -118.13], "Duluth": [46.79, -92.1], "Eau Claire": [44.81, -91.5], "El Monte": [34.07, -118.03], "Elgin": [42.04, -88.28], "Elk Grove City": [38.41, -121.37], "Escondido": [33.12, -117.09], "Eugene": [44.05, -123.09], "Evanston": [42.05, -87.69], "Evansville": [37.97, -87.56], "Everett": [47.98, -122.2], "Fall River": [41.7, -71.15], "Fargo": [46.88, -96.79], "Fayetteville AR": [36.06, -94.16], "Fayetteville NC": [35.05, -78.88], "Federal Way": [47.31, -122.31], "Fishers": [39.96, -86.01], "Flagstaff": [35.2, -111.65], "Flower Mound": [33.01, -97.1], "Fontana": [34.09, -117.44], "Fort Myers": [26.64, -81.87], "Fort Smith": [35.39, -94.4], "Fort Wayne": [41.08, -85.14], "Foster City": [37.56, -122.27], "Fredericksburg": [38.3, -77.46], "Fremont": [37.55, -121.99], "Frisco": [33.15, -96.82], "Gainesville": [29.65, -82.32], "Garden Grove": [33.77, -117.94], "Garland": [32.91, -96.64], "Georgetown": [30.63, -97.68], "Gilbert": [33.35, -111.79], "Glendale": [34.14, -118.26], "Glendale AZ": [33.54, -112.19], "Goodyear": [33.44, -112.36], "Grand Prairie": [32.75, -97.02], "Great Falls": [47.51, -111.3], "Greensboro": [36.07, -79.79], "Greenville": [34.85, -82.39], "Greenville NC": [35.61, -77.37], "Gresham": [45.5, -122.43], "Gulfport": [30.37, -89.09], "Half Moon Bay": [37.46, -122.43], "Hampton": [37.03, -76.35], "Hayward": [37.67, -122.08], "Henderson": [36.04, -114.98], "Hesperia": [34.43, -117.3], "Hialeah": [25.86, -80.28], "High Point": [35.96, -80.01], "Hillsboro": [45.52, -122.99], "Hilo": [19.72, -155.08], "Hollywood": [26.01, -80.15], "Hoover": [33.41, -86.81], "Huntington Beach": [33.66, -117.99], "Huntsville": [34.73, -86.59], "Idaho Falls": [43.47, -112.03], "Independence": [39.09, -94.35], "Iowa City": [41.66, -91.53], "Irving": [32.81, -96.95], "Issaquah": [47.53, -122.04], "Ithaca": [42.44, -76.5], "Jackson MS": [32.3, -90.18], "Joliet": [41.53, -88.08], "Jurupa Valley": [33.99, -117.49], "Kailua": [21.4, -157.74], "Kennewick": [46.21, -119.17], "Kenosha": [42.58, -87.82], "Key West": [24.56, -81.78], "Killeen": [31.12, -97.73], "Kirkland": [47.68, -122.21], "Kissimmee": [28.29, -81.41], "Kyle": [29.99, -97.88], "La Crosse": [43.8, -91.24], "Lafayette": [40.42, -86.87], "Lafayette LA": [30.22, -92.02], "Lake Charles": [30.23, -93.22], "Lakeland": [28.04, -81.95], "Lancaster": [34.7, -118.14], "Laredo": [27.51, -99.51], "Largo": [27.91, -82.79], "Lawrence": [38.97, -95.24], "Layton": [41.06, -111.97], "League City": [29.51, -95.09], "Leander": [30.58, -97.85], "Lexington SC": [33.98, -81.24], "Lincoln": [40.81, -96.7], "Little Rock": [34.75, -92.29], "Livermore": [37.68, -121.77], "Los Gatos": [37.23, -121.96], "Lowell": [42.63, -71.32], "Lubbock": [33.58, -101.85], "Lynchburg": [37.41, -79.14], "Lynnwood": [47.82, -122.32], "Manchester NH": [42.99, -71.45], "Mansfield": [32.56, -97.14], "Marietta": [33.95, -84.55], "Marysville": [48.05, -122.18], "Maui": [20.8, -156.32], "McAllen": [26.2, -98.23], "McKinney": [33.2, -96.64], "Medford": [42.33, -122.87], "Melbourne": [28.08, -80.61], "Menlo Park": [37.45, -122.18], "Meridian": [43.61, -116.39], "Midland": [31.99, -102.08], "Milpitas": [37.43, -121.9], "Miramar": [25.99, -80.3], "Mission Viejo": [33.6, -117.67], "Missoula": [46.87, -114.0], "Mobile": [30.69, -88.04], "Modesto": [37.64, -120.99], "Montgomery": [32.38, -86.3], "Montpelier": [44.26, -72.58], "Moreno Valley": [33.94, -117.23], "Mount Pleasant": [32.79, -79.86], "Mountain View": [37.39, -122.08], "Myrtle Beach": [33.69, -78.89], "Nampa": [43.54, -116.56], "Napa": [38.3, -122.3], "Naperville": [41.79, -88.15], "Naples": [26.14, -81.79], "Nashua": [42.77, -71.47], "New Bedford": [41.64, -70.93], "New Braunfels": [29.7, -98.12], "New Haven": [41.31, -72.92], "Newport Beach": [33.62, -117.93], "Newport News": [37.09, -76.47], "Newton": [42.34, -71.21], "Norfolk": [36.85, -76.29], "North Las Vegas": [36.2, -115.12], "Oak Park": [41.89, -87.78], "Ocala": [29.19, -82.14], "Oceanside": [33.2, -117.38], "Ogden": [41.23, -111.97], "Olathe": [38.88, -94.82], "Olympia": [47.04, -122.9], "Ontario": [34.07, -117.65], "Orem": [40.3, -111.7], "Oshkosh": [44.02, -88.54], "Overland Park": [38.98, -94.67], "Palm Bay": [28.03, -80.59], "Palmdale": [34.58, -118.12], "Parma": [41.4, -81.73], "Pasadena TX": [29.69, -95.21], "Pawtucket": [41.88, -71.38], "Pembroke Pines": [26.0, -80.34], "Pensacola": [30.42, -87.22], "Peoria": [40.69, -89.59], "Peoria AZ": [33.58, -112.24], "Petaluma": [38.23, -122.64], "Pflugerville": [30.44, -97.62], "Plantation": [26.13, -80.23], "Pleasanton": [37.66, -121.87], "Plymouth": [45.01, -93.46], "Pomona": [34.06, -117.75], "Pompano Beach": [26.24, -80.12], "Port St. Lucie": [27.29, -80.35], "Portland ME": [43.66, -70.26], "Provo": [40.23, -111.66], "Quincy": [42.25, -71.0], "Racine": [42.73, -87.78], "Rancho Cucamonga": [34.11, -117.59], "Redding": [40.59, -122.39], "Redmond": [47.67, -122.12], "Redwood City": [37.49, -122.24], "Reno": [39.53, -119.81], "Renton": [47.48, -122.22], "Reston": [38.97, -77.34], "Richardson": [32.95, -96.73], "Rochester MN": [44.02, -92.47], "Rock Hill": [34.93, -81.02], "Rockford": [42.27, -89.09], "Roseville": [38.75, -121.29], "Roswell": [34.02, -84.36], "Round Rock": [30.51, -97.68], "Rowlett": [32.9, -96.56], "Salem OR": [44.94, -123.04], "Salinas": [36.68, -121.66], "Sammamish": [47.62, -122.04], "San Bernardino": [34.11, -117.29], "San Carlos": [37.51, -122.26], "San Leandro": [37.73, -122.16], "San Marcos": [33.14, -117.17], "San Marcos TX": [29.88, -97.94], "San Mateo": [37.56, -122.31], "San Rafael": [37.97, -122.53], "San Ramon": [37.78, -121.98], "Sandy Springs": [33.93, -84.37], "Sandy UT": [40.59, -111.88], "Santa Clarita": [34.39, -118.54], "Santa Maria": [34.95, -120.44], "Santa Rosa": [38.44, -122.71], "Sarasota": [27.34, -82.53], "Saratoga": [37.26, -122.02], "Saratoga Springs": [43.08, -73.79], "Schaumburg IL": [42.03, -88.08], "Schenectady": [42.81, -73.94], "Sedona": [34.87, -111.76], "Shreveport": [32.53, -93.75], "Simi Valley": [34.27, -118.78], "Sioux Falls": [43.55, -96.73], "Smyrna": [33.88, -84.51], "Somerville": [42.39, -71.1], "South Gate": [33.95, -118.21], "Sparks": [39.53, -119.75], "Spartanburg": [34.95, -81.93], "Springfield MA": [42.1, -72.59], "Springfield MO": [37.21, -93.29], "St. Augustine": [29.89, -81.31], "St. George": [37.1, -113.58], "St. Paul": [44.94, -93.09], "Stamford": [41.05, -73.54], "Stockton": [37.96, -121.29], "Sugar Land": [29.62, -95.63], "Sunnyvale": [37.37, -122.04], "Sunrise": [26.13, -80.29], "Surprise": [33.63, -112.37], "Tallahassee": [30.44, -84.28], "Temple": [31.1, -97.34], "Terre Haute": [39.47, -87.41], "The Woodlands": [30.17, -95.5], "Thousand Oaks": [34.17, -118.84], "Toledo": [41.65, -83.54], "Topeka": [39.05, -95.68], "Torrance": [33.84, -118.34], "Tuscaloosa": [33.21, -87.57], "Twin Falls": [42.56, -114.46], "Tyler": [32.35, -95.3], "Utica": [43.1, -75.23], "Vacaville": [38.36, -121.99], "Valdosta": [30.83, -83.28], "Vallejo": [38.1, -122.26], "Vancouver WA": [45.64, -122.66], "Victorville": [34.54, -117.35], "Visalia": [36.33, -119.29], "Vista": [33.2, -117.24], "Waco": [31.55, -97.15], "Walnut Creek": [37.91, -122.07], "Warner Robins": [32.62, -83.6], "Warwick": [41.7, -71.42], "Waterbury": [41.56, -73.04], "Waukegan": [42.36, -87.84], "West Palm Beach": [26.72, -80.05], "West Valley City": [40.69, -112.0], "Westminster": [33.75, -117.99], "White Plains": [41.03, -73.77], "Whitefish": [48.41, -114.35], "Wichita": [37.69, -97.34], "Wilmington NC": [34.23, -77.94], "Winston-Salem": [36.1, -80.24], "Winter Park": [28.6, -81.34], "Woodinville": [47.75, -122.16], "Woodland": [38.68, -121.77], "Worcester": [42.26, -71.8], "Yonkers": [40.93, -73.9], "Youngstown": [41.1, -80.65], "Yuma": [32.69, -114.62], "Land van Cuijk": [51.73, 5.88], "Groningen": [53.22, 6.57], "Haarlem": [52.38, 4.64], "Heerlen": [50.89, 5.98], "Rotterdam": [51.92, 4.48], "Den Haag": [52.08, 4.3], "Eindhoven": [51.44, 5.47], "Helmond": [51.48, 5.66], "Emmen": [52.79, 6.9], "Uithoorn": [52.24, 4.83], "Vijfheerenlanden": [51.96, 5.08], "Amsterdam": [52.37, 4.9], "Differdange": [49.52, 5.89], "Brussels": [50.85, 4.35], "Antwerp": [51.22, 4.4], "Utrecht": [52.09, 5.12], "Madrid": [40.42, -3.7], "Palma de Mallorca": [39.57, 2.65], "Palma": [39.57, 2.65], "Barcelona": [41.39, 2.17], "Valencia": [39.47, -0.38], "Seville": [37.39, -5.98], "Taurag\u0117": [55.25, 22.29], "Paris": [48.86, 2.35], "Rome": [41.9, 12.5], "Lisbon": [38.72, -9.14], "Warsaw": [52.23, 21.01], "Prague": [50.08, 14.44], "Budapest": [47.5, 19.04], "Dublin": [53.35, -6.26], "Bucharest": [44.43, 26.1], "Athens": [37.98, 23.73], "Zagreb": [45.81, 15.98], "Ljubljana": [46.06, 14.51], "Bratislava": [48.15, 17.11], "Tallinn": [59.44, 24.75], "Riga": [56.95, 24.11], "Vilnius": [54.69, 25.28], "Sofia": [42.7, 23.32], "Washoe County, NV": [39.65, -119.73], "Louisville, CO": [39.98, -105.13], "Wilmette, IL": [42.08, -87.73], "Pitkin County, CO": [39.22, -106.93], "Pima County, AZ": [32.1, -111.79], "Cleveland, OH": [41.5, -81.69], "Stevens Point, WI": [44.52, -89.57], "Monona, WI": [43.06, -89.33], "Rock County, WI": [42.67, -89.07], "Ann Arbor, MI": [42.28, -83.74], "Elm Grove, WI": [43.04, -88.08], "Green County, WI": [42.68, -89.6], "Middleton, WI": [43.1, -89.5], "McFarland, WI": [43.01, -89.29], "Green Bay, WI": [44.51, -88.02], "Wilmington, DE": [39.74, -75.55], "Ingham County, MI": [42.6, -84.37], "Mercer County, NJ": [40.28, -74.7], "Moab, UT": [38.57, -109.55], "Howard County, MD": [39.25, -76.93], "Harris County, TX": [29.86, -95.39], "Palo Alto, CA": [37.44, -122.14], "Pacifica, CA": [37.61, -122.49], "Providence, RI": [41.82, -71.41], "Truckee, CA": [39.33, -120.18], "Hailey, ID": [43.52, -114.32], "Blaine County, ID": [43.4, -114.11], "Fairfield, OH": [39.35, -84.56], "Washtenaw County, MI": [42.25, -83.83], "Gaithersburg, MD": [39.14, -77.2], "Takoma Park, MD": [38.98, -77.01], "Oberlin, OH": [41.29, -82.22], "Skokie, IL": [42.03, -87.74], "Bainbridge Island, WA": [47.63, -122.52], "Kenmore, WA": [47.76, -122.24], "Boise, ID": [43.62, -116.2], "Hastings-on-Hudson, NY": [40.99, -73.88], "Crested Butte, CO": [38.87, -106.99], "Los Alamos County, NM": [35.89, -106.3], "Sterling Heights, MI": [42.58, -83.03], "Guadalupe, CA": [34.97, -120.57], "Apex, NC": [35.73, -78.85], "Lakewood, CO": [39.7, -105.08], "Douglas County, KS": [38.88, -95.3], "Eagle County, CO": [39.63, -106.59], "Solebury Township, PA": [40.39, -75.02], "Lansing, MI": [42.73, -84.56], "Fort Lauderdale, FL": [26.12, -80.14], "Bath, ME": [43.91, -69.82], "Broomfield, CO": [39.92, -105.09], "Charleston County, SC": [32.78, -79.93], "Oakland County, MI": [42.66, -83.39], "Dane County, WI": [43.07, -89.42], "Ulster County, NY": [41.88, -74.26], "Summit County, UT": [40.86, -111.08], "Hoboken, NJ": [40.74, -74.03], "Union City, CA": [37.6, -122.04], "Annapolis, MD": [38.98, -76.49], "Chittenden County, VT": [44.48, -73.13], "Torrance, CA": [33.84, -118.34], "Waukesha, WI": [43.01, -88.23], "Tulare County, CA": [36.33, -119.29], "Sonoma County, CA": [38.44, -122.72], "Governors Island, NY": [40.69, -74.02], "Syracuse": [43.05, -76.15], "Highland Park, IL": [42.18, -87.8], "La Crosse County, WI": [43.91, -91.11], "Milwaukee County, WI": [43.01, -87.97], "Tampa Bay, FL": [27.96, -82.54]};
var ALIASES = {"Hameln Pyrmont": "Hameln", "L\u00fcchow Dannenberg": "L\u00fcchow-Dannenberg", "Nienburg/Weser": "Nienburg", "Rotenburg W\u00fcmme": "Rotenburg", "Madrid Ayuntamiento": "Madrid", "Castrop Rauxel": "Castrop-Rauxel", "Berlin Land": "Berlin", "Berlin  ": "Berlin", "Ennepe Ruhr": "Ennepe-Ruhr", "Kamp Lintfort": "Kamp-Lintfort", "Munchen": "M\u00fcnchen", "Neukirchen Vluyn": "Neukirchen-Vluyn", "Oer Erkenschwick": "Oer-Erkenschwick", "Siegen Wittgenstein": "Siegen", "Solingen Klingenstadt": "Solingen", "Ville de Differdange": "Differdange", "Waldshut Tiengen Stadtwerke": "Waldshut-Tiengen", "Baden W\u00fcrttemberg Land": "Baden-W\u00fcrttemberg", "Taurag\u00e9s": "Taurag\u0117", "Southwark London Borough": "Southwark", "Havering London Borough": "Havering", "Islington London Borough": "Islington", "Newham London Borough": "Newham", "Dumfries and Galloway": "Dumfries", "Comhairle nan Eilean Siar": "Outer Hebrides", "Manchester Climate Change": "Manchester", "Borl\u00e4nge Nordics Sweden": "Borl\u00e4nge", "Helsingborg impact assessment": "Helsingborg", "Helsingborg Fastighetsf\u00f6rvaltning": "Helsingborg", "Helsingborgs": "Helsingborg", "V\u00e4sterbotten L\u00e4nsstyrelsen": "V\u00e4sterbotten", "Kronoberg L\u00e4nsstyrelsen": "Kronoberg", "Norrbotten L\u00e4nsstyrelsen": "Norrbotten", "Enk\u00f6pings": "Enk\u00f6ping", "Grand Valley Metropolitan , MI": "Grand Rapids, MI", "Indiana University ERI Indianapolis & South Bend": "Indianapolis, IN", "Keramida Louiseville": "Louisville, KY", "Lexington Keramida": "Lexington, KY", "MARC": "Kansas City, MO", "Wisconsin Local Government Coalition": "Madison, WI", "Energielenker Training": "Osnabr\u00fcck", "Business Sweden": "Stockholm", "Klimatpolitiska R\u00e5det": "Stockholm", "East Central Florida Regional Planning Council": "Orlando", "Chittenden County Regional Planning Commission": "Chittenden County, VT", "Midcoast Council of Governments": "Bath, ME", "Central New York Regional Planning and Development Board": "Syracuse", "EcoAction Partners": "Pitkin County, CO", "South Bay Cities Council of Governments": "Torrance, CA", "Greater Nashville Regional Council - Nashville, TN": "Nashville", "Southeastern Wisconsin Regional Planning Commission (SEWRPC)": "Waukesha, WI", "Tulare County Resource Management Agency": "Tulare County, CA", "Sonoma County TCA": "Sonoma County, CA", "The Trust For Governors Island": "Governors Island, NY", "Tampa Bay Regional Planning Council": "Tampa Bay, FL", "Houston Galveston Area Council": "Houston"};

var MARKET_COLORS = {
  "Germany": "#4CAF50", "UK": "#E74C3C", "Nordics": "#2196F3",
  "US": "#26A69A", "Benelux": "#FFC107",
  "Austria": "#8BC34A", "Switzerland": "#FF7043",
  "Spain": "#FF9800", "Other": "#78909C"
};
var LEGEND_ORDER = ["Germany","Austria","Switzerland","UK","Nordics","Benelux","US","Spain","Other"];
var SCENE_COLORS = { "Europe":"#555555","DACH":"#4CAF50","UK":"#E74C3C","Nordics":"#2196F3","Benelux":"#FFC107","US":"#26A69A" };
var SCENE_TEXT = { "Europe":"#ffffff","DACH":"#ffffff","UK":"#ffffff","Nordics":"#ffffff","Benelux":"#1a1a1a","US":"#ffffff" };

// ---- MAP INIT ----
var map = L.map('map', {
  zoomControl: false, attributionControl: false,
  minZoom: 2, maxZoom: 14, zoomSnap: 0.5,
  zoomDelta: 0.5, worldCopyJump: true
}).setView([52.5, 10], 5);

L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',
  subdomains: 'abcd', maxZoom: 19
}).addTo(map);

// ---- CSV PARSER ----
function parseCSV(text) {
  var lines = text.trim().split('\n');
  if (lines.length < 2) return [];
  var headers = parseCSVLine(lines[0]);
  var rows = [];
  for (var i = 1; i < lines.length; i++) {
    var vals = parseCSVLine(lines[i]);
    var row = {};
    for (var j = 0; j < headers.length; j++) {
      row[headers[j].trim()] = (vals[j] || '').trim();
    }
    rows.push(row);
  }
  return rows;
}

function parseCSVLine(line) {
  var result = []; var current = ''; var inQuotes = false;
  for (var i = 0; i < line.length; i++) {
    var ch = line[i];
    if (inQuotes) {
      if (ch === '"' && line[i+1] === '"') { current += '"'; i++; }
      else if (ch === '"') { inQuotes = false; }
      else { current += ch; }
    } else {
      if (ch === '"') { inQuotes = true; }
      else if (ch === ',') { result.push(current); current = ''; }
      else { current += ch; }
    }
  }
  result.push(current);
  return result;
}

// ---- MARKET MAPPING ----
function mapMarket(sheetMarket, country) {
  var m = (sheetMarket || '').trim().toUpperCase();
  if (m === 'DACH') {
    if (country.trim() === 'Austria') return 'Austria';
    if (country.trim() === 'Switzerland') return 'Switzerland';
    return 'Germany';
  }
  if (m === 'UK') return 'UK';
  if (m === 'NORDICS') return 'Nordics';
  if (m === 'NORTH AMERICA') return 'US';
  if (m === 'BENELUX') return 'Benelux';
  if (m === 'IBERIA') return 'Spain';
  return 'Other';
}

// ---- CITY MATCHING (alias -> direct -> partial) ----
function findCoords(cityName, country, sheetMarket) {
  // 1. Try alias first
  var aliased = ALIASES[cityName];
  if (aliased && COORDS[aliased]) return { coords: COORDS[aliased], displayName: aliased };

  // 2. Direct match
  if (COORDS[cityName]) return { coords: COORDS[cityName], displayName: cityName };

  // 3. US: strip ", XX" state suffix → try bare city name
  var isUS = (sheetMarket.toUpperCase() === 'NORTH AMERICA' || country === 'US' || country === 'United States' || country === 'United States of America' || country === 'USA');
  if (isUS) {
    var stateMatch = cityName.match(/^(.+),\s*[A-Z]{2}$/);
    if (stateMatch) {
      var bare = stateMatch[1].trim();
      if (COORDS[bare]) return { coords: COORDS[bare], displayName: bare };
    }
  }

  // 4. US partial match: "Elk Grove" -> "Elk Grove, CA" or reverse
  if (isUS) {
    var keys = Object.keys(COORDS);
    for (var i = 0; i < keys.length; i++) {
      if (keys[i].indexOf(cityName + ',') === 0 || cityName.indexOf(keys[i] + ',') === 0) {
        return { coords: COORDS[keys[i]], displayName: keys[i] };
      }
    }
  }

  // 5. General partial match
  var keys2 = Object.keys(COORDS);
  for (var j = 0; j < keys2.length; j++) {
    if (cityName.indexOf(keys2[j]) === 0 || keys2[j].indexOf(cityName) === 0) {
      return { coords: COORDS[keys2[j]], displayName: keys2[j] };
    }
  }

  return null;
}

// ---- PIN SVG ----
var pinSvg = function(color, isNew) {
  var pulse = isNew ? '<span class="pulse-dot" style="color:' + color + '"></span>' : '';
  return '<span class="pin-inner">' + pulse + '<svg viewBox="0 0 12 16" width="12" height="17" xmlns="http://www.w3.org/2000/svg">' +
    '<path d="M6 0C2.7 0 0 2.7 0 6c0 4.5 6 10 6 10s6-5.5 6-10c0-3.3-2.7-6-6-6z" fill="' + color + '"/>' +
    '<circle cx="6" cy="5.8" r="2" fill="white" opacity="0.9"/></svg></span>';
};

// ---- GEOCODING FALLBACK (OpenStreetMap Nominatim) ----
function geocodeCity(cityName, country) {
  var query = encodeURIComponent(cityName + ', ' + country);
  var url = 'https://nominatim.openstreetmap.org/search?q=' + query + '&format=json&limit=1&email=map@climateview.global';
  return fetch(url, { headers: { 'Accept': 'application/json' } })
    .then(function(r) {
      if (!r.ok) {
        console.warn('[ClimateView] Geocode HTTP ' + r.status + ' for ' + cityName);
        return [];
      }
      return r.json();
    })
    .then(function(data) {
      if (data && data.length > 0) {
        console.log('[ClimateView] Geocoded: ' + cityName + ' → [' + data[0].lat + ', ' + data[0].lon + ']');
        return { coords: [parseFloat(data[0].lat), parseFloat(data[0].lon)], displayName: cityName };
      }
      console.warn('[ClimateView] No results for: ' + cityName + ', ' + country);
      return null;
    })
    .catch(function(err) {
      console.error('[ClimateView] Geocode error for ' + cityName + ':', err.message || err);
      return null;
    });
}

function geocodeBatch(items) {
  // Sequential with 1.1s delay to respect Nominatim rate limit
  var results = [];
  var chain = Promise.resolve();
  items.forEach(function(item, idx) {
    chain = chain.then(function() {
      return geocodeCity(item.cityName, item.country).then(function(result) {
        results.push({ item: item, result: result });
        if (idx < items.length - 1) {
          return new Promise(function(resolve) { setTimeout(resolve, 1100); });
        }
      });
    });
  });
  return chain.then(function() { return results; });
}

// ---- FETCH & RENDER ----
var loadingEl = document.getElementById('loading');

function tryFetch(url, label) {
  console.log('[ClimateView] Fetching ' + label + ': ' + url);
  return fetch(url).then(function(r) {
    console.log('[ClimateView] Response status: ' + r.status + ' from ' + label);
    if (!r.ok) throw new Error('HTTP ' + r.status + ' from ' + label);
    return r.text();
  });
}

// Try main URL first, then with explicit gid=0
tryFetch(SHEET_URL, 'primary')
  .catch(function() {
    return tryFetch(SHEET_URL + '&gid=0', 'with gid=0');
  })
  .then(function(csv) {
    loadingEl.style.display = 'none';
    console.log('[ClimateView] CSV length: ' + csv.length + ' chars');

    var rows = parseCSV(csv);
    console.log('[ClimateView] Parsed ' + rows.length + ' rows');
    if (rows.length > 0) {
      console.log('[ClimateView] Columns:', Object.keys(rows[0]));
    }

    var cities = [];
    var needGeocode = [];
    var seenCoords = {};

    rows.forEach(function(row) {
      var cityName = row['City Name (Cleaned)'] || row['City Name'] || row['city'] || row['City'] || '';
      var country = row['Country'] || row['country'] || '';
      var sheetMarket = row['Market'] || row['market'] || '';
      if (!cityName) return;

      var result = findCoords(cityName, country, sheetMarket);
      if (!result) {
        needGeocode.push({ cityName: cityName, country: country, sheetMarket: sheetMarket });
        return;
      }

      // Deduplicate by coordinates
      var coordKey = result.coords[0] + ',' + result.coords[1];
      if (seenCoords[coordKey]) return;
      seenCoords[coordKey] = true;

      var market = mapMarket(sheetMarket, country);
      cities.push({
        name: result.displayName,
        lat: result.coords[0],
        lng: result.coords[1],
        country: country,
        market: market
      });
    });

    // Render matched cities immediately
    console.log('[ClimateView] Rendering ' + cities.length + ' matched cities immediately');
    if (cities.length === 0 && rows.length > 0) {
      loadingEl.style.display = 'block';
      loadingEl.innerHTML = 'Data loaded (' + rows.length + ' rows) but no cities matched.<br>Columns: ' + Object.keys(rows[0]).join(', ') + '<br>Check console (F12).';
      loadingEl.style.fontSize = '11px'; loadingEl.style.textAlign = 'center';
      loadingEl.style.maxWidth = '400px'; loadingEl.style.lineHeight = '1.6';
    }
    renderMap(cities);

    // Geocode remaining cities in the background and add them incrementally
    if (needGeocode.length > 0) {
      console.log('[ClimateView] Geocoding ' + needGeocode.length + ' cities in background via Nominatim');
      console.log('[ClimateView] UNMATCHED CITIES LIST:');
      needGeocode.forEach(function(x) { console.log('  ' + x.cityName + ' | ' + x.country + ' | ' + x.sheetMarket); });
      geocodeBatch(needGeocode).then(function(geoResults) {
        var geocoded = 0;
        var failed = [];
        var newCities = [];
        geoResults.forEach(function(gr) {
          if (gr.result) {
            var coordKey = gr.result.coords[0] + ',' + gr.result.coords[1];
            if (!seenCoords[coordKey]) {
              seenCoords[coordKey] = true;
              var market = mapMarket(gr.item.sheetMarket, gr.item.country);
              var city = {
                name: gr.result.displayName,
                lat: gr.result.coords[0],
                lng: gr.result.coords[1],
                country: gr.item.country,
                market: market
              };
              newCities.push(city);
              geocoded++;
            }
          } else {
            failed.push(gr.item.cityName);
          }
        });
        if (geocoded > 0) {
          console.log('[ClimateView] Geocoded ' + geocoded + ' cities, adding to map');
          addCitiesToMap(newCities);
        }
        if (failed.length > 0) console.log('[ClimateView] Failed to geocode:', failed);
      });
    }
  })
  .catch(function(err) {
    console.error('[ClimateView] Failed to load sheet:', err);
    loadingEl.innerHTML = 'Failed to load data: ' + err.message + '<br>Refresh to retry.';
    loadingEl.style.fontSize = '11px'; loadingEl.style.textAlign = 'center';
    loadingEl.style.lineHeight = '1.6';
  });

function renderMap(cities) {
  // ---- COUNTER ----
  var total = cities.length;
  var countries = {};
  var marketCounts = {};
  cities.forEach(function(c) {
    countries[c.country] = true;
    marketCounts[c.market] = (marketCounts[c.market] || 0) + 1;
  });
  var countryCount = Object.keys(countries).length;
  document.getElementById('country-count').textContent = countryCount + ' countries';

  var counterEl = document.getElementById('counter');
  var duration = 2000; var start = performance.now();
  function tick(now) {
    var t = Math.min((now - start) / duration, 1);
    var ease = 1 - Math.pow(1 - t, 3);
    counterEl.textContent = Math.round(ease * total);
    if (t < 1) requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  // ---- LEGEND ----
  var legendEl = document.getElementById('legend');
  var legendHTML = '';
  LEGEND_ORDER.forEach(function(m) {
    var count = marketCounts[m] || 0;
    if (count === 0) return;
    var color = MARKET_COLORS[m] || '#888';
    legendHTML += '<div class="legend-item">' +
      '<svg class="legend-pin" viewBox="0 0 12 16" width="12" height="16">' +
      '<path d="M6 0C2.7 0 0 2.7 0 6c0 4.5 6 10 6 10s6-5.5 6-10c0-3.3-2.7-6-6-6z" fill="' + color + '"/>' +
      '<circle cx="6" cy="5.8" r="2" fill="white" opacity="0.9"/></svg>' +
      m + ' (' + count + ')</div>';
  });
  legendEl.innerHTML = legendHTML;

  // ---- NEW-CITY DETECTION via localStorage ----
  var STORAGE_KEY = 'cv_map_cities_v2';
  var newCitySet = {};
  try {
    var now = Date.now();
    var stored = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    var isFirstLoad = Object.keys(stored).length === 0;
    var updated = {};
    cities.forEach(function(c) {
      var key = c.name + '|' + c.country;
      if (stored[key] !== undefined) {
        updated[key] = stored[key];
        if (stored[key] > 0 && now - stored[key] < 30 * 24 * 60 * 60 * 1000) {
          newCitySet[key] = true;
        }
      } else {
        updated[key] = isFirstLoad ? 0 : now;
        if (!isFirstLoad) { newCitySet[key] = true; }
      }
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(updated));
  } catch(e) {}

  // ---- MARKERS with fly-in animation ----
  var sorted = cities.slice().sort(function(a, b) { return a.lng - b.lng; });
  var allMarkers = [];
  sorted.forEach(function(city, i) {
    var color = MARKET_COLORS[city.market] || '#78909C';
    var isNew = !!newCitySet[city.name + '|' + city.country];
    var icon = L.divIcon({
      className: 'pin-marker',
      html: pinSvg(color, isNew),
      iconSize: [12, 17], iconAnchor: [6, 17]
    });
    var marker = L.marker([city.lat, city.lng], { icon: icon })
      .bindTooltip(city.name + ' \u2013 ' + city.country, {
        direction: 'right', offset: [8, -7], opacity: 1
      }).addTo(map);
    allMarkers.push({ marker: marker, index: i });
  });

  // Fly-in: staggered with randomness for organic feel
  allMarkers.forEach(function(item) {
    var delay = 700 + item.index * 10 + Math.random() * 180;
    setTimeout(function() {
      var el = item.marker.getElement ? item.marker.getElement() : item.marker._icon;
      if (el) el.classList.add('fly-in');
    }, delay);
  });

  // ---- PERMANENT CITY LABELS ----
  var cityLabels = [
    [48.86, 2.35, 'Paris'], [41.90, 12.50, 'Rome'],
    [38.72, -9.14, 'Lisbon'], [59.91, 10.75, 'Oslo'],
    [55.68, 12.57, 'Copenhagen'], [60.17, 24.94, 'Helsinki'],
    [53.35, -6.26, 'Dublin'], [52.23, 21.01, 'Warsaw'],
    [50.08, 14.44, 'Prague'], [47.50, 19.04, 'Budapest'],
    [46.95, 7.45, 'Bern'], [52.37, 4.90, 'Amsterdam'],
    [50.85, 4.35, 'Brussels'], [40.42, -3.70, 'Madrid'],
    [48.21, 16.37, 'Vienna'], [52.52, 13.41, 'Berlin'],
    [51.51, -0.13, 'London'], [59.33, 18.07, 'Stockholm'],
    [55.95, -3.19, 'Edinburgh'],
    [48.14, 11.58, 'Munich'], [53.55, 9.99, 'Hamburg'],
    [40.71, -74.01, 'New York'], [38.91, -77.04, 'Washington DC'],
    [34.05, -118.24, 'Los Angeles'], [41.88, -87.63, 'Chicago'],
  ];
  cityLabels.forEach(function(cl) {
    L.marker([cl[0], cl[1]], {
      icon: L.divIcon({ className: 'city-label', html: '<span>' + cl[2] + '</span>', iconSize: [0, 0], iconAnchor: [0, 6] }),
      interactive: false, zIndexOffset: -1000
    }).addTo(map);
  });

  setTimeout(startAutoPan, 4000);
}

// ---- ADD GEOCODED CITIES INCREMENTALLY ----
function addCitiesToMap(newCities) {
  // Update counter
  var counterEl = document.getElementById('counter');
  var current = parseInt(counterEl.textContent) || 0;
  counterEl.textContent = current + newCities.length;

  // Add pins
  newCities.forEach(function(city, i) {
    var color = MARKET_COLORS[city.market] || '#78909C';
    var icon = L.divIcon({
      className: 'pin-marker',
      html: pinSvg(color, false),
      iconSize: [12, 17], iconAnchor: [6, 17]
    });
    var marker = L.marker([city.lat, city.lng], { icon: icon })
      .bindTooltip(city.name + ' \u2013 ' + city.country, {
        direction: 'right', offset: [8, -7], opacity: 1
      }).addTo(map);
    setTimeout(function() {
      var el = marker.getElement ? marker.getElement() : marker._icon;
      if (el) el.classList.add('fly-in');
    }, 200 + i * 50);
  });
}

// ---- REGION TAG ----
var regionTag = document.getElementById('region-tag');
var showRegionTag = function(label) {
  var bg = SCENE_COLORS[label] || '#555'; var fg = SCENE_TEXT[label] || '#fff';
  regionTag.style.background = bg; regionTag.style.color = fg;
  regionTag.textContent = label; regionTag.classList.add('visible');
};
var hideRegionTag = function() { regionTag.classList.remove('visible'); };

// ---- AUTO-PAN ----
var scenes = [
  { lat: 52.0, lng: 8.5, zoom: 5, label: 'Europe', dwell: 8000 },
  { lat: 50.5, lng: 10.0, zoom: 6, label: 'DACH', dwell: 9000 },
  { lat: 55.5, lng: -3.5, zoom: 6, label: 'UK', dwell: 8000 },
  { lat: 60.0, lng: 16.0, zoom: 5.5, label: 'Nordics', dwell: 8000 },
  { lat: 52.0, lng: 5.5, zoom: 7.5, label: 'Benelux', dwell: 7000 },
  { lat: 40.0, lng: -88.0, zoom: 4, label: 'US', dwell: 8000 },
];
var sceneIndex = 0; var autoPanTimer = null;
var pauseTimer = null; var isPaused = false; var isAutoPanning = false;

var nextScene = function() {
  if (isPaused) return;
  var scene = scenes[sceneIndex];
  showRegionTag(scene.label);
  isAutoPanning = true;
  map.flyTo([scene.lat, scene.lng], scene.zoom, { duration: 4.5, easeLinearity: 0.15 });
  map.once('moveend', function() { isAutoPanning = false; });
  sceneIndex = (sceneIndex + 1) % scenes.length;
  autoPanTimer = setTimeout(nextScene, scene.dwell + 4500);
};

var pauseAutoPan = function() {
  if (isAutoPanning) return;
  isPaused = true; hideRegionTag();
  clearTimeout(autoPanTimer); clearTimeout(pauseTimer);
  pauseTimer = setTimeout(function() { isPaused = false; nextScene(); }, 30000);
};

function startAutoPan() { nextScene(); }

map.on('mousedown dragstart zoomstart', pauseAutoPan);
document.addEventListener('mousemove', function() {
  if (!isPaused) return;
  clearTimeout(pauseTimer);
  pauseTimer = setTimeout(function() { isPaused = false; nextScene(); }, 30000);
});
</script>
</body>
</html>